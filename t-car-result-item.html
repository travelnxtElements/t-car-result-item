<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../t-image/t-image.html">
<link rel="import" href="../t-button/t-button.html">
<link rel="import" href="../t-text-container/travel-element-styles.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../t-shared-lib/t-fare-behavior.html">
<link rel="import" href="../t-car-category-item/t-car-category-item.html">
<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->
<dom-module id="t-car-result-item">
    <template>
        <style include="t-car-category-item"></style>
        <style include="iron-flex"></style>
        <style include="travel-element-styles">
        :host {
            display: block;
            border: 0;
            --t-button: {
                padding: 7px;
            }
        }
        .badge {
            position: relative;
            padding: 2px 5px;
            background: #fd9a01;
            color: #ffffff;
        }
        .badge::after,.badge::before{
            content: "";
            position: absolute;
            right: 98%;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
        }
        .badge::before{
            bottom: 0;
            border-bottom: 10px solid  var(--badge-bg,#fd9a01);
        }
        .badge::after{
            top: 0;
            border-top: 10px solid  var(--badge-bg,#fd9a01);
        }
        .right-section {
            margin-left: 10px;
        }
        .logo-area img {
            max-height: 24px;
        }
        .icon-item{
            min-width: 33px;
        }
        .icon-item [icon]{
            margin: 0 auto;
            display: block;
        }
        .icons-area .text{
            margin: 0;
            display: block;
            text-align: center;
        }
        .devider{
            margin: 0 var(--normal-spacing,10px);
            border-bottom: 1px dashed var(--grey-two,#eeeeee);
        }
        .devider.last-border{
            border-bottom: 1px solid var(--grey-two,#eeeeee);
        }
        .left-section .item{
            margin-bottom: 5px;
        }
        .uppercase{
        	text-transform: uppercase;
        }
        </style>
        <template is="dom-if" if="[[isFirstItem]]">
            <t-image sizing="contain" class="imageArea" height="120" src="[[itinerary.heroImageUrl]]"></t-image>
            <div class="font-12 category primary-light-text layout horizontal center border-bottom">
                <span class="font-18 ">[[itinerary.category]]</span>
                <span class="flex"></span>
                <span>[[currency]]&nbsp;</span>
                <span class="font-16">[[price]]</span>
                <span>&nbsp;AVG PER DAY</span>
            </div>
        </template>
        <div class="font-12 secondary-text">
            <div class="section-small layout horizontal">
                <div class="logo-area flex font-14">
                    <template is="dom-if" if="[[itinerary.brand.logo]]">
                        <img src$="[[itinerary.brand.logo]]" alt$="[[itinerary.brand.name]]" />
                    </template>
                    <template is="dom-if" if="[[!itinerary.brand.logo]]">
                        <div class="font-semi uppercase">[[itinerary.brand.name]]</div>
                    </template>
                    <div>[[itinerary.name]]</div>
                </div>
                <template is="dom-if" if="[[itinerary.isPostPaid]]">
                    <div class="right-section">
                        <div class="badge font-10">BOOK NOW PAY LATER</div>
                    </div>
                </template>
            </div>
            <div class="devider"></div>
            <div class="section-small layout horizontal">
                <div class="icons-area flex layout horizontal">
                    <template is="dom-if" if="[[_checkIfNotSpecified(itinerary.capacity)]]">
	                    <div class="icon-item">
	                        <iron-icon icon="car:seat"></iron-icon>
	                        <span class="text">[[itinerary.capacity]]</span>
	                    </div>
					</template>
                    <div class="icon-item">
                        <iron-icon icon="car:luggage"></iron-icon>
                        <span class="text">[[itinerary.baggage]]</span>
                    </div>

                    <div class="icon-item">
                        <iron-icon icon="car:gear"></iron-icon>
                        <span class="text">[[_checkIfAutomatic(itinerary.transmission)]]</span>
                    </div>

                    <template is="dom-if" if="[[_checkIfNotSpecified(itinerary.doors)]]">
	                    <div class="icon-item">
	                        <iron-icon icon="car:door"></iron-icon>
	                        <span class="text">[[itinerary.doors]]</span>
	                    </div>
                    </template>
                    <template is="dom-if" if="[[itinerary.airConditioning]]">
                        <div class="icon-item">
                            <iron-icon icon="car:ac"></iron-icon>
                            <span class="text">AC</span>
                        </div>
                    </template>
                </div>
                <div class="right-section">
                    <div class="text-right">
                        <span class="font-14">[[currency]]</span>
                        <span class="font-16 font-semi primary-text">[[_getDisplayFare(_displayPrice.money.amount)]]</span>
                    </div>
                    <div class="text-right">total</div>
                </div>
            </div>
            <div class="devider"></div>
            <div class="section-small layout horizontal">
                <div class="left-section flex">
                    <div class="item ellipsis-2">PICK-UP - [[itinerary.pickupInfo.address]]</div>
                    <template is="dom-if" if="[[!_isSameString(itinerary.pickupInfo.address,itinerary.dropoffInfo.address)]]">
                        <div class="item ellipsis-2">DROP-OFF - [[itinerary.dropoffInfo.address]]</div>
                    </template>
                    <template is="dom-if" if="[[_isSameString(itinerary.pickupInfo.address,itinerary.dropoffInfo.address)]]">
                        <div class="item">DROP-OFF - Same as pick-up location</div>
                    </template>
                    <div class="link-style">Policy</div>
                </div>
                <div class="right-section">
                    <t-button id="search" class="primary" on-click="_bookCar" type="button" label="book" /></t-button>
                </div>
            </div>
            <div class="devider last-border"></div>
        </div>
    </template>
    <script>
    (function() {
        Polymer({
            is: 't-car-result-item',

            properties: {
                showImage: {
                    type: Boolean,
                    value: false
                },

                price: {
                    type: String,
                    value: ''
                },
                currency: {
                    type: String,
                    value: 'USD'
                },
                bookPeriod: {
                    type: Number
                },
                itinerary: {
                    type: Object,
                    value: null
                }
            },

            behaviors: [TravelNxt.Behaviors.FareBehavior],

            observers: [
                '_onItineraryUpdate(itinerary)'
            ],

            _checkIfAutomatic:  function(value){
                if(!value){
                    return null;
                }
                if (value.toLowerCase() === 'automatic') {
                    return 'Auto';
                }
                return value;
            },


            _checkIfNotSpecified:  function(value){
                if(!value){
                    return false;
                }
                if (value.toLowerCase() === 'notspecified') {
                    return false;
                }
                return true;
            },

            _isSameString: function(val1,val2){
                return val1 === val2;
            },

            _onItineraryUpdate: function() {    
                if (this.itinerary && this.itinerary.fare) {
                    this._components = this.itinerary.fare.components;
                    this.isFirstItem = this.itinerary.isFirstItinerary;
                }
            },

            _getDisplayFare: function(amount) {
                if (amount) {
                    return Math.ceil(amount) ;
                }
                return null;
            },

            _bookCar: function () {
                if (this.itinerary.fare) {
                    this.itinerary.fare = null;
                }
                this.fire('book-car-itinerary', this.itinerary);
            }
        });
    })();
    </script>
</dom-module>
