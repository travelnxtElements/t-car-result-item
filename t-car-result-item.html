<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../t-image/t-image.html">
<link rel="import" href="../t-text-container/travel-element-styles.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../t-shared-lib/t-fare-behavior.html">
<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->
<dom-module id="t-car-result-item">
    <template>
        <style include="iron-flex"></style>
        <style include="travel-element-styles">
        :host {
            display: block;
        }
        
        .imageArea {
            width: auto;
            height: 250px;
            position: relative;
        }
        
        .imageArea t-image {
            width: 100%;
            height: 100%;
        }
        
        .logoArea {
            width: 50px;
            height: 20px;
            position: relative;
        }
        
        .logoArea t-image {
            width: 100%;
            height: 100%;
        }
        </style>
        <h1>Car Result Item!</h1>
        <div class="imageArea">
            <t-image src="{{imageUrl}}"></t-image>
        </div>
        <div>{{name}}</div>
        <div>{{vehicleType}}</div>
        <div>{{location}}</div>
        <div class="logoArea">
            <t-image src="{{logo}}"></t-image>
        </div>
        <div>{{capacity}}</div>
        <div>{{baggage}}</div>
        <div>{{airConditioning}}</div>
        <div>{{transmission}}</div>
        <div>{{doors}}</div>

        <div>{{_getDisplayFare(_displayPrice.money.amount, itinerary.stayDuration.start.date, itinerary.stayDuration.end.date)}}</div>
    </template>
    <script>
    (function() {
        Polymer({
            is: 't-car-result-item',
            properties: {
                name: {
                    type: String,
                    value: ''
                },
                vehicleType: {
                    type: String,
                    value: ''
                },
                location: {
                    type: String,
                    value: ''
                },
                price: {
                    type: String,
                    value: ''
                },
                tag: {
                    type: String,
                    value: ''
                },
                imageUrl: {
                    type: String,
                    value: ''
                },
                itinerary: {
                    type: Object,
                    value: {
                        "type": "Car",
                        "brand": {
                            "code": "AL",
                            "name": "Alamo",
                            "logo": "https://cdn.cartrawler.com/otaimages/vendor/ALAMO.jpg"
                        },
                        "heroImageUrl": "https://cdn.cartrawler.com/otaimages/toyota/rav_4_nologo.jpg",
                        "fareType": null,
                        "airConditioning": "Yes",
                        "capacity": "FourToFive",
                        "category": "Intermediate",
                        "baggage": 3,
                        "doors": "Five",
                        "driveType": "NotSpecified",
                        "fuelType": "NotSpecified",
                        "transmission": "Automatic",
                        "vehicleType": "SUV",
                        "generalPolicies": [{
                            "type": "Fee to pay on arrival",
                            "policies": [
                                "Fee to pay on arrival : 216.87 USD."
                            ]
                        }, {
                            "type": "Rental Rules",
                            "policies": [
                                "Your car rental base rate is guaranteed and payable upon pick-up at the counter.",
                                "The rate is guaranteed for the time frame between the stated pick-up and return times. Vehicles returned outside of these times may be subject to additional rental fees.",
                                "A valid driverâ€™s license and major credit card are required in order to pick-up the car. Taxes and surcharges are estimated and payable at the rental counter. ",
                                "Drivers under the age of 25 may be denied the rental. Please make sure your rental provider is aware of drivers under the age of 25. Where applicable, additional fees may apply for drivers under 25 years of age, additional drivers, debit card usage or optional services."
                            ]
                        }],
                        "mileage": {
                            "allowedUnits": {
                                "amount": 0.0,
                                "from": "City",
                                "unit": "Kilometer",
                                "displayAmount": "0.00km"
                            },
                            "isUnlimited": true,
                            "rateType": "Unspecified",
                            "extraMileageCharges": [

                            ]
                        },
                        "pickupInfo": {
                            "address": "7135 Gilespie Street, Las Vegas, 89119-1256, Nv Las Vegas NV 89119-1256 US",
                            "completeAddress": {
                                "addressLine1": "7135 Gilespie Street, Las Vegas, 89119-1256, Nv",
                                "addressLine2": "",
                                "completeAddress": "7135 Gilespie Street, Las Vegas, 89119-1256, Nv Las Vegas NV 89119-1256 US",
                                "phoneNumber": "+1-702-6666747",
                                "zipCode": "89119-1256",
                                "city": "Las Vegas",
                                "country": "US",
                                "state": "NV"
                            },
                            "atAirport": true,
                            "startTime": "",
                            "endTime": "",
                            "inTerminal": false,
                            "shuttleInfo": "CarRentalShuttle",
                            "type": "Corporate",
                            "distance": {
                                "amount": 0.24,
                                "from": "Airport",
                                "unit": "Mile",
                                "displayAmount": "0.00km"
                            }
                        },
                        "dropoffInfo": {
                            "address": "7135 Gilespie Street, Las Vegas, 89119-1256, Nv Las Vegas NV 89119-1256 US",
                            "completeAddress": {
                                "addressLine1": "7135 Gilespie Street, Las Vegas, 89119-1256, Nv",
                                "addressLine2": "",
                                "completeAddress": "7135 Gilespie Street, Las Vegas, 89119-1256, Nv Las Vegas NV 89119-1256 US",
                                "phoneNumber": "+1-702-6666747",
                                "zipCode": "89119-1256",
                                "city": "Las Vegas",
                                "country": "US",
                                "state": "NV"
                            },
                            "atAirport": true,
                            "startTime": "",
                            "endTime": "",
                            "inTerminal": false,
                            "shuttleInfo": "CarRentalShuttle",
                            "type": "Corporate",
                            "distance": {
                                "amount": 0.24,
                                "from": "Airport",
                                "unit": "Mile",
                                "displayAmount": "0.00km"
                            }
                        },
                        "policies": null,
                        "minFare": {
                            "areRatesAvailable": true,
                            "fare": {
                                "amount": 216.87,
                                "currency": "USD",
                                "displayAmount": "$216.87",
                                "type": "USD"
                            },
                            "equivalentFares": [

                            ],
                            "equivalents": null
                        },
                        "guaranteeText": null,
                        "phoneNumber": "703/684-8184 x32",
                        "isCancellable": true,
                        "allPassengersInfoRequired": false,
                        "isGuaranteeRequired": false,
                        "id": "MF9fYWM0MGQ3ZTYtNzk5YS00YWNkLWJhZTctYzI0ZmU4MmZjNzA3",
                        "name": "Toyota Rav4 or similar",
                        "fare": {
                            "type": "Published",
                            "code": null,
                            "isRefundable": false,
                            "components": [{
                                "money": {
                                    "amount": 216.87,
                                    "currency": "USD",
                                    "displayAmount": "$216.87",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "BaseFare",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 216.87,
                                    "currency": "USD",
                                    "displayAmount": "$216.87",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalFare",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 0.0,
                                    "currency": "USD",
                                    "displayAmount": "$0.00",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalFee",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 0.0,
                                    "currency": "USD",
                                    "displayAmount": "$0.00",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalTax",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 0.0,
                                    "currency": "USD",
                                    "displayAmount": "$0.00",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalDiscount",
                                "properties": [

                                ]
                            }],
                            "equivalents": null
                        },
                        "fareWithAddOns": {
                            "type": "Published",
                            "code": null,
                            "isRefundable": false,
                            "components": [{
                                "money": {
                                    "amount": 216.87,
                                    "currency": "USD",
                                    "displayAmount": "$216.87",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "BaseFare",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 216.87,
                                    "currency": "USD",
                                    "displayAmount": "$216.87",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalFare",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 0.0,
                                    "currency": "USD",
                                    "displayAmount": "$0.00",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalFee",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 0.0,
                                    "currency": "USD",
                                    "displayAmount": "$0.00",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalTax",
                                "properties": [

                                ]
                            }, {
                                "money": {
                                    "amount": 0.0,
                                    "currency": "USD",
                                    "displayAmount": "$0.00",
                                    "type": "USD"
                                },
                                "components": [

                                ],
                                "type": "TotalDiscount",
                                "properties": [

                                ]
                            }],
                            "equivalents": null
                        },
                        "isPostPaid": true,
                        "isSoldOut": false,
                        "isPreferred": false,
                        "addOns": null,
                        "preferredSortOrder": 0,
                        "source": {
                            "inventoryId": "MF9fYWM0MGQ3ZTYtNzk5YS00YWNkLWJhZTctYzI0ZmU4MmZjNzA3",
                            "id": 119,
                            "name": "TAA-CAL"
                        },
                        "restrictions": null
                    },
                    observer: '_onItineraryUpdate'
                }
            },

            behaviors: [TravelNxt.Behaviors.FareBehavior],

            _onItineraryUpdate: function() {
                this._setItineraryProperties();
            },

            _setItineraryProperties: function() {
                if (!this.itinerary) {
                    return;
                }

                this.name = this.itinerary.name;
                this.vehicleType = this.itinerary.vehicleType;
                this.location = this.itinerary.pickupInfo.address;
                // this.price = this._getPrice();
                // this.tag = this._getTag();
                this.imageUrl = this.itinerary.heroImageUrl;
                this.logo = this.itinerary.brand.logo;

                this.capacity = this.itinerary.capacity;
                this.baggage = this.itinerary.baggage;
                this.airConditioning = this.itinerary.airConditioning;
                this.transmission = this.itinerary.transmission;
                this.doors = this.itinerary.doors;
                this._components = this.itinerary.fare.components;
            },

            _fareComponentsChanged: function(components) {
                this._components = components;
                var x = this._displayPrice;
            },

            _getDisplayFare: function(amount, checkIn, checkOut) {
                if (amount) {
                    return Math.ceil(amount / this._dateDiff(checkIn, checkOut));
                }
                return null;
            }
        });
    })();
    </script>
</dom-module>
